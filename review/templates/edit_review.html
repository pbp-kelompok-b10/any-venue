<div id="editReviewModal"
    class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/50">

    <div id="editReviewModalContent"
        class="bg-white shadow-xl
        w-[85%] sm:w-[60%] md:w-[45%] lg:w-[40%]
        max-h-[90vh] overflow-y-auto
        px-10 py-10 relative font-['Roboto']
        transform transition-all duration-300 opacity-0 scale-95">

        <button type="button"
            class="absolute top-4 right-4 text-black hover:text-gray-600 text-lg"
            onclick="hideEditReviewModal()">
            ✕
        </button>

        <div class="w-full text-center mb-6">
            <h2 class="text-3xl font-bold text-black">Edit Review</h2>
            <p class="text-xs text-gray-600 mt-1">Update your previously submitted review.</p>
        </div>

        <form id="editReviewForm" method="POST" action=""
            class="w-full flex flex-col gap-6">
            {% csrf_token %} <input type="hidden" name="review_id" id="editReviewId">

            <div class="flex flex-col gap-2">
                <label class="text-s text-black">Rate Venue</label>

                <div id="editStarContainer" class="flex gap-1">
                    <span data-value="1" class="editStar cursor-pointer text-gray-300 text-2xl">★</span>
                    <span data-value="2" class="editStar cursor-pointer text-gray-300 text-2xl">★</span>
                    <span data-value="3" class="editStar cursor-pointer text-gray-300 text-2xl">★</span>
                    <span data-value="4" class="editStar cursor-pointer text-gray-300 text-2xl">★</span>
                    <span data-value="5" class="editStar cursor-pointer text-gray-300 text-2xl">★</span>
                </div>

                <input type="hidden" name="rating" id="editRatingValue" required>
            </div>

            <div class="flex flex-col gap-2">
                <label for="edit_review_content" class="text-s text-black">Review</label>
                <textarea id="edit_review_content" name="comment" rows="5"
                    class="w-full p-3 border border-gray-700 resize-none"
                    placeholder="Update your experience..." required></textarea>
            </div>

            <div class="flex justify-end gap-3 mt-2">
                <button type="button"
                    class="px-5 py-2 border border-black text-black hover:bg-gray-100"
                    onclick="hideEditReviewModal()">
                    Cancel
                </button>

                <button type="submit"
                    class="px-5 py-2 bg-black text-white hover:bg-gray-900">
                    Update Review
                </button>
            </div>

        </form>
    </div>
</div>

<script>
    const editReviewModal = document.getElementById('editReviewModal');
    const editReviewModalContent = document.getElementById('editReviewModalContent');
    const editStars = document.querySelectorAll('.editStar');
    const editRatingValue = document.getElementById('editRatingValue');
    const editReviewContent = document.getElementById('edit_review_content');
    const editReviewId = document.getElementById('editReviewId');
    const editReviewForm = document.getElementById('editReviewForm');

    function showEditReviewModal(reviewId, currentRating, currentComment) {
        // isi form dengan data yang ada
        editReviewId.value = reviewId;
        editRatingValue.value = currentRating;
        editReviewContent.value = currentComment;
        highlightStars(currentRating); // set tampilan stars sesuai rating

        editReviewForm.action = `/review/edit/${reviewId}/`;

        // show modal
        editReviewModal.classList.remove('hidden');
        setTimeout(() => {
            editReviewModalContent.classList.remove('opacity-0', 'scale-95');
            editReviewModalContent.classList.add('opacity-100', 'scale-100');
        }, 50);
    }

    function hideEditReviewModal() {
        editReviewModalContent.classList.remove('opacity-100', 'scale-100');
        editReviewModalContent.classList.add('opacity-0', 'scale-95');
        setTimeout(() => {
            editReviewModal.classList.add('hidden');
        }, 150);
    }

    function highlightStars(rating) {
        editStars.forEach(s => {
            if (s.getAttribute('data-value') <= rating) {
                s.classList.add('text-yellow-400');
                s.classList.remove('text-gray-300');
            } else {
                s.classList.add('text-gray-300');
                s.classList.remove('text-yellow-400');
            }
        });
    }

    editStars.forEach(star => {
        star.addEventListener('mouseover', () => {
            const rating = star.getAttribute('data-value');
            highlightStars(rating);
        });

        star.addEventListener('mouseout', () => {
            highlightStars(editRatingValue.value || 0);
        });

        star.addEventListener('click', () => {
            const rating = star.getAttribute('data-value');
            editRatingValue.value = rating;
            highlightStars(rating);
        });
    });

    document.getElementById("editReviewForm").addEventListener("submit", function (e) {
        if (!editRatingValue.value) {
            alert("Please select a rating first!");
            e.preventDefault();
        }
    });

</script>