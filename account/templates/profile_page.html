{% extends "base.html" %}
{% load static %}

{% block title %}AnyVenue â€“ Profile Page{% endblock %}

{% block content %}
{% include 'navbar.html' %}

<div class="w-full px-16 py-28 bg-gradient-to-b from-Light-Navy to-Flash-White flex flex-col items-center gap-20">
    <div class="w-full max-w-[1280px] flex flex-col gap-20">
        <!-- Profile Info -->
        <div class="flex justify-between items-end">
            <div class="flex-1 max-w-[768px] flex flex-col gap-4">
                <div class="text-Flash-White text-5xl font-bold">
                    {{ profile.user.username }}
                </div>
                <div class="text-white text-lg">{{ profile.role }}</div>
                
                {% if profile.user.is_authenticated %}
                <!-- Hanya terlihat jika sudah login -->
                <div class="text-Flash-White text-lg">{{ profile.user.profile.bio|default:"No bio" }}</div>
                <!-- <div class="text-white text-base">Alamat: {{ profile.user.profile.address|default:"-" }}</div>
                <div class="text-white text-base">Umur: {{ profile.user.profile.age|default:"-" }}</div>
                <div class="text-white text-base">No HP: {{ profile.user.profile.phone|default:"-" }}</div> -->
                <!-- <div class="text-white text-base">Last Login: {{ profile.user.last_login }}</div>
                {% else %} -->
                <!-- Hanya info umum untuk user belum login -->
                <div class="text-Flash-White text-lg">Bio: Info terbatas, login untuk melihat lebih lengkap</div>
                {% endif %}
            </div>

            {% if user.is_authenticated %}
            <div class="flex gap-4">
                <button id="edit-profile" class="px-6 py-3 outline outline-1 outline-Flash-White text-Flash-White">Edit Profile</button>
                <button id="delete-account" class="px-6 py-3 bg-black text-white outline outline-1 outline-black">Hapus akun</button>
            </div>
            {% endif %}
        </div>

        <!-- Tabs -->
        <div class="flex gap-4">
            <div class="px-4 py-2 outline outline-1 text-Flash-White">Booking</div>
            <div class="px-4 py-2 text-Flash-White">Events</div>
        </div>

        <!-- Booking List -->
        <!-- {% if user.is_authenticated %}
        <div class="flex flex-col gap-8">
            {% for booking in bookings %}
            <div class="flex gap-8 p-8 bg-Color-Scheme-1-Foreground outline outline-1 outline-Color-Scheme-1-Border">
                <div class="w-24 flex flex-col items-center">
                    <div>{{ booking.date|date:"D" }}</div>
                    <div class="text-3xl font-bold">{{ booking.date|date:"d" }}</div>
                    <div>{{ booking.date|date:"M Y" }}</div>
                </div>
                <div class="w-24 self-stretch rotate-90 outline outline-1 outline-Color-Scheme-1-Border"></div>
                <div class="flex-1 flex flex-col gap-4">
                    <div class="flex items-center gap-4">
                        <div class="text-2xl font-bold">{{ booking.venue_name }}</div>
                        {% if booking.is_sold_out %}
                        <div class="px-2 py-1 bg-gray-200 text-gray-800 text-sm font-semibold">Sold out</div>
                        {% endif %}
                    </div>
                    <div class="text-sm">{{ booking.location }}</div>
                    <div class="text-base">{{ booking.description }}</div>
                </div>
                <button class="delete-booking px-5 py-2 outline outline-1 outline-gray-800 text-gray-800" data-id="{{ booking.id }}">
                    Delete
                </button>
            </div>
            {% empty %}
            <div class="text-white">No bookings yet.</div>
            {% endfor %}
        </div>
        {% else %} -->
        <div class="text-white mt-8">Login untuk melihat daftar booking</div>
        <!-- {% endif %} -->
    </div>
</div>

{% include 'footer.html' %}

{% if user.is_authenticated %}
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script>
$(document).ready(function(){
    $(".delete-booking").click(function(){
        const bookingId = $(this).data("id");
        const csrfToken = '{{ csrf_token }}';
        const row = $(this).closest("div.flex.gap-8");

        $.ajax({
            url: "{% url 'delete_booking' %}",
            method: "POST",
            data: {
                'id': bookingId,
                'csrfmiddlewaretoken': csrfToken
            },
            success: function(response){
                if(response.status == "ok"){
                    row.remove();
                }
            }
        });
    });
});
</script>
{% endif %}

